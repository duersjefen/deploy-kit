#!/bin/bash
# Auto-generated by deploy-kit ccw
# Setup MCP servers for Claude Code for the Web

set -e

echo "üîß Setting up MCP servers for CCW..."

# Install jq (JSON processor)
echo "üì¶ Installing jq..."
command -v jq >/dev/null 2>&1 || {
  if [[ "$OSTYPE" == "darwin"* ]]; then
    brew install jq
  else
    apt-get update && apt-get install -y jq
  fi
}

# Install GitHub CLI
echo "üì¶ Installing GitHub CLI..."
command -v gh >/dev/null 2>&1 || {
  if [[ "$OSTYPE" == "darwin"* ]]; then
    brew install gh
  else
    curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
    apt update && apt install gh
  fi
}

# Authenticate GitHub CLI
if [ -n "$GITHUB_TOKEN" ]; then
  echo "$GITHUB_TOKEN" | gh auth login --with-token
  echo "‚úÖ GitHub CLI authenticated"
else
  echo "‚ö†Ô∏è  GITHUB_TOKEN not set - GitHub operations will fail"
fi

# Install MCP servers
echo "üì¶ Installing MCP servers..."
npm install -g @modelcontextprotocol/server-playwright
npm install -g @context7/mcp-server
npm install -g @modelcontextprotocol/server-linear

# Verify Linear API key
if [ -n "$LINEAR_API_KEY" ]; then
  echo "‚úÖ LINEAR_API_KEY detected"
else
  echo "‚ö†Ô∏è  LINEAR_API_KEY not set - Linear operations will fail"
fi

# Verify npm token
if [ -n "$NPM_TOKEN" ]; then
  echo "‚úÖ NPM_TOKEN detected"
else
  echo "‚ö†Ô∏è  NPM_TOKEN not set - npm publish will fail"
fi

echo ""
echo "‚úÖ MCP setup complete!"
echo ""
echo "MCP servers installed:"
echo "  - Playwright (browser automation)"
echo "  - Context7 (library documentation)"
echo "  - Linear (issue tracking)"
